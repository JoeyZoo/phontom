<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zj.videoservice.mapper.OutdoorVideoPlayRecordMapper">
    <select id="countPlayNum" parameterType="Long" resultType="VideoVO">
       SELECT
           ov.id,
           ov.title,
           COUNT( ovpr.video_id ) AS playNum
       FROM
           outdoor_video ov
           LEFT JOIN outdoor_video_play_record ovpr ON ov.`id` = ovpr.`video_id`
       WHERE
           ov.id = #{id} AND ovpr.`is_deleted`=0;
    </select>

    <select id="countTotalPlayNum" parameterType="Long" resultType="UpTotalDataVO">
      SELECT
          ou.`id`,
          COUNT( ovpr.`up_id` ) AS totalPlayNum
      FROM
          outdoor_user ou
          LEFT JOIN outdoor_video_play_record ovpr ON ou.`id` = ovpr.`up_id`
      WHERE
          ou.`id` = #{id} AND ovpr.`is_deleted`=0;
    </select>

    <select id="listPlayHistorys" parameterType="Long" resultType="PlayHistoryVO">
        SELECT
            ovpr.id,
            ovpr.fan_id,
            ov.video_source_id,
            ov.title,
            ov.cover,
            ovpr.gmt_create
        FROM
            `outdoor_video_play_record` ovpr
            LEFT JOIN `outdoor_video` ov ON ov.id = ovpr.video_id
        WHERE
            ov.is_deleted = 0
            AND ovpr.is_deleted = 0
            AND ovpr.fan_id = #{fanId}
        GROUP BY
            ovpr.id
        ORDER BY
            ovpr.gmt_create DESC
            LIMIT 5;
    </select>

</mapper>
